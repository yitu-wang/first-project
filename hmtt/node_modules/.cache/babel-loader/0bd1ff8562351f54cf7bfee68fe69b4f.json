{"ast":null,"code":"import _objectSpread from \"C:/Users/\\u5C0F\\u738B/Desktop/heimamm/hmtt/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _regeneratorRuntime from \"C:/Users/\\u5C0F\\u738B/Desktop/heimamm/hmtt/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/Users/\\u5C0F\\u738B/Desktop/heimamm/hmtt/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.regexp.test.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapMutations } from \"vuex\";\nimport { getUserAPI, changeImgAPI, changeUserAPI as _changeUserAPI } from \"@/api/index.js\";\nimport { Dialog, Notify } from 'vant';\nimport { name } from 'dayjs/locale/zh';\nexport default {\n  name: 'edituser',\n  data: function data() {\n    return {\n      user: {},\n      //个人信息\n      photo: '',\n      //修改图片后的新地址\n      nameShow: false,\n      sexShow: false,\n      birShow: false,\n      columns: ['男', '女'],\n      currentDate: new Date(),\n      minDate: new Date(1999, 1, 1),\n      maxDate: new Date(),\n      userName: ''\n    };\n  },\n  created: function created() {\n    var _this = this;\n\n    return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      var res;\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return getUserAPI();\n\n            case 2:\n              res = _context.sent;\n              _this.user = res.data.data;\n              _this.photo = res.data.data.photo;\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  },\n  methods: _objectSpread(_objectSpread({}, mapMutations(['set_userphoto'])), {}, {\n    //修改头像方法\n    imgChange: function imgChange(e) {\n      var _this2 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var theFd, res;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!(e.target.files.length === 0)) {\n                  _context2.next = 2;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\");\n\n              case 2:\n                //将这个文件的地址传入后端\n                //1.创建Formdata对象\n                theFd = new FormData();\n                theFd.append('photo', e.target.files[0]); //2.将图片数据推送到新建的表单对象中\n                //3.发起请求\n\n                _context2.next = 6;\n                return changeImgAPI(theFd);\n\n              case 6:\n                res = _context2.sent;\n                _this2.photo = res.data.data.photo;\n\n                _this2.set_userphoto(res.data.date.photo);\n\n              case 9:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }))();\n    },\n    //修改用户资料方法\n    changeUserAPI: function changeUserAPI(_ref) {\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        var name, gender, birthday, intro, res;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                name = _ref.name, gender = _ref.gender, birthday = _ref.birthday, intro = _ref.intro;\n                _context3.next = 3;\n                return _changeUserAPI({\n                  name: name,\n                  gender: gender,\n                  birthday: birthday,\n                  intro: intro\n                });\n\n              case 3:\n                res = _context3.sent;\n                console.log(res);\n\n              case 5:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }))();\n    },\n    //修改姓名\n    userNameShow: function userNameShow() {\n      this.nameShow = true;\n      this.userName = this.user.name;\n    },\n    changeName: function changeName() {\n      var reg = /^[a-zA-Z0-9_\\u4e00-\\u9fa5]{1,7}$/;\n\n      if (this.userName !== '' && reg.test(this.userName) === true) {\n        this.changeUserAPI({\n          name: this.userName\n        });\n        this.user.name = this.userName;\n      } else {\n        Notify({\n          type: \"warning\",\n          message: \"用户名只能为中英文字符\"\n        });\n      }\n    },\n    //修改性别\n    changeSex: function changeSex(value, index) {\n      this.user.gender = index;\n      this.changeUserAPI({\n        gender: this.user.gender\n      });\n      this.sexShow = false;\n    },\n    //定义时间函数\n    formatDate: function formatDate(time) {\n      var date = new Date(time);\n      var year = date.getFullYear(),\n          month = date.getMonth() + 1,\n          //月份是从0开始的\n      day = date.getDate();\n      var newTime = year + '-' + month + '-' + day + ' ';\n      return newTime;\n    },\n    //修改生日\n    changeBir: function changeBir(value) {\n      this.user.birthday = this.formatDate(value);\n      this.changeUserAPI({\n        birthday: this.user.birthday\n      });\n      this.birShow = false;\n    }\n  })\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+BA,SACAA,YADA,QAEA,MAFA;AAGA,SACAC,UADA,EAEAC,YAFA,EAGAC,+BAHA,QAIA,gBAJA;AAKA,SACAC,MADA,EAEAC,MAFA,QAGA,MAHA;AAIA,SACAC,IADA,QAEA,iBAFA;AAGA;EACAA,gBADA;EAEAC,IAFA,kBAEA;IACA;MACAC,QADA;MACA;MACAC,SAFA;MAEA;MACAC,eAHA;MAIAC,cAJA;MAKAC,cALA;MAMAC,mBANA;MAOAC,uBAPA;MAQAC,6BARA;MASAC,mBATA;MAUAC;IAVA;EAYA,CAfA;EAgBAC,OAhBA,qBAgBA;IAAA;;IAAA;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA;cAAA,OACAjB,YADA;;YAAA;cACAkB,GADA;cAEA;cACA;;YAHA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA;EAIA,CApBA;EAqBAC,yCACApB,+BADA;IAEA;IACAqB,SAHA,qBAGAC,CAHA,EAGA;MAAA;;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,MACAA,2BADA;kBAAA;kBAAA;gBAAA;;gBAAA;;cAAA;gBAEA;gBACA;gBACAC,KAJA,GAIA,cAJA;gBAKAA,yCALA,CAKA;gBACA;;gBANA;gBAAA,OAOArB,mBAPA;;cAAA;gBAOAiB,GAPA;gBAQA;;gBACA;;cATA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAUA,CAbA;IAcA;IACAhB,aAfA,+BAoBA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAJAG,IAIA,QAJAA,IAIA,EAHAkB,MAGA,QAHAA,MAGA,EAFAC,QAEA,QAFAA,QAEA,EADAC,KACA,QADAA,KACA;gBAAA;gBAAA,OACAvB;kBACAG,UADA;kBAEAkB,cAFA;kBAGAC,kBAHA;kBAIAC;gBAJA,EADA;;cAAA;gBACAP,GADA;gBAOAQ;;cAPA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAQA,CA5BA;IA6BA;IACAC,YA9BA,0BA8BA;MACA;MACA;IACA,CAjCA;IAkCAC,UAlCA,wBAkCA;MACA;;MACA;QACA;UACAvB;QADA;QAGA;MACA,CALA,MAKA;QACAD;UACAyB,eADA;UAEAC;QAFA;MAKA;IACA,CAhDA;IAiDA;IACAC,SAlDA,qBAkDAC,KAlDA,EAkDAC,KAlDA,EAkDA;MACA;MACA;QACAV;MADA;MAGA;IACA,CAxDA;IAyDA;IACAW,UA1DA,sBA0DAC,IA1DA,EA0DA;MACA;MACA;MAAA,IACAC,2BADA;MAAA,IACA;MACAC,oBAFA;MAGA,2BACAD,KADA,GACA,GADA,GAEAC,GAFA,GAEA,GAFA;MAGA;IACA,CAnEA;IAoEA;IACAC,SArEA,qBAqEAN,KArEA,EAqEA;MACA;MACA;QACAR;MADA;MAGA;IACA;EA3EA;AArBA","names":["mapMutations","getUserAPI","changeImgAPI","changeUserAPI","Dialog","Notify","name","data","user","photo","nameShow","sexShow","birShow","columns","currentDate","minDate","maxDate","userName","created","res","methods","imgChange","e","theFd","gender","birthday","intro","console","userNameShow","changeName","type","message","changeSex","value","index","formatDate","time","month","day","changeBir"],"sourceRoot":"src/views/User","sources":["editUser.vue"],"sourcesContent":["//用户编辑资料页面\r\n<template>\r\n  <div>\r\n    <!-- 头部导航 -->\r\n    <van-nav-bar title=\"编辑资料\" left-arrow @click-left=\"$router.push('/layout/user')\" />\r\n    <!-- 编辑区域 -->\r\n    <van-cell title=\"头像\" is-link center>\r\n      <template #default>\r\n        <label for=\"imgChange\">\r\n          <van-image round class=\"avatar\" :src=\"photo\"></van-image>\r\n        </label>\r\n        <input type=\"file\" name=\"imgChange\" id=\"imgChange\" v-show=\"false\" @change=\"imgChange\">\r\n      </template>\r\n    </van-cell>\r\n    <van-cell title=\"名称\" is-link :value=\"user.name\" @click=\"userNameShow\" />\r\n    <van-dialog v-model=\"nameShow\" title=\"修改姓名\" show-cancel-button @confirm=\"changeName\">\r\n      <van-field v-model.trim=\"userName\" placeholder=\"请输入用户名\" v-fofo />\r\n    </van-dialog>\r\n    <van-cell title=\"性别\" is-link :value=\"user.gender===1? '女':'男'\" @click=\"sexShow=true\" />\r\n    <van-popup v-model=\"sexShow\" position=\"bottom\" :overlay=\"false\" overlay>\r\n      <van-picker :columns=\"columns\" @cancel=\"sexShow=false\" @confirm=\"changeSex\" show-toolbar />\r\n    </van-popup>\r\n    <van-cell title=\"生日\" is-link :value=\"user.birthday\" @click=\"birShow=true\" />\r\n    <van-popup v-model=\"birShow\" position=\"bottom\" :overlay=\"false\" overlay>\r\n      <van-datetime-picker v-model=\"currentDate\" type=\"date\" @confirm=\"changeBir\" :min-date=\"minDate\"\r\n        :max-date=\"maxDate\" @cancel=\"birShow=false\" />\r\n    </van-popup>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import {\r\n    mapMutations\r\n  } from \"vuex\"\r\n  import {\r\n    getUserAPI,\r\n    changeImgAPI,\r\n    changeUserAPI\r\n  } from \"@/api/index.js\"\r\n  import {\r\n    Dialog,\r\n    Notify\r\n  } from 'vant';\r\n  import {\r\n    name\r\n  } from 'dayjs/locale/zh';\r\n  export default {\r\n    name: 'edituser',\r\n    data() {\r\n      return {\r\n        user: {}, //个人信息\r\n        photo: '', //修改图片后的新地址\r\n        nameShow: false,\r\n        sexShow: false,\r\n        birShow: false,\r\n        columns: ['男', '女'],\r\n        currentDate: new Date(),\r\n        minDate: new Date(1999, 1, 1),\r\n        maxDate: new Date(),\r\n        userName: ''\r\n      }\r\n    },\r\n    async created() {\r\n      const res = await getUserAPI()\r\n      this.user = res.data.data\r\n      this.photo = res.data.data.photo\r\n    },\r\n    methods: {\r\n      ...mapMutations(['set_userphoto']),\r\n      //修改头像方法\r\n      async imgChange(e) {\r\n        if (e.target.files.length === 0) return\r\n        //将这个文件的地址传入后端\r\n        //1.创建Formdata对象\r\n        let theFd = new FormData()\r\n        theFd.append('photo', e.target.files[0]) //2.将图片数据推送到新建的表单对象中\r\n        //3.发起请求\r\n        const res = await changeImgAPI(theFd)\r\n        this.photo = res.data.data.photo\r\n        this.set_userphoto(res.data.date.photo)\r\n      },\r\n      //修改用户资料方法\r\n      async changeUserAPI({\r\n        name,\r\n        gender,\r\n        birthday,\r\n        intro\r\n      }) {\r\n        const res = await changeUserAPI({\r\n          name,\r\n          gender,\r\n          birthday,\r\n          intro\r\n        })\r\n        console.log(res);\r\n      },\r\n      //修改姓名\r\n      userNameShow() {\r\n        this.nameShow = true\r\n        this.userName = this.user.name\r\n      },\r\n      changeName() {\r\n        let reg = /^[a-zA-Z0-9_\\u4e00-\\u9fa5]{1,7}$/\r\n        if (this.userName !== '' && reg.test(this.userName) === true) {\r\n          this.changeUserAPI({\r\n            name: this.userName\r\n          })\r\n          this.user.name = this.userName\r\n        } else {\r\n          Notify({\r\n            type: \"warning\",\r\n            message: \"用户名只能为中英文字符\"\r\n          })\r\n\r\n        }\r\n      },\r\n      //修改性别\r\n      changeSex(value, index) {\r\n        this.user.gender = index\r\n        this.changeUserAPI({\r\n          gender: this.user.gender\r\n        })\r\n        this.sexShow = false\r\n      },\r\n      //定义时间函数\r\n      formatDate(time) {\r\n        var date = new Date(time);\r\n        var year = date.getFullYear(),\r\n          month = date.getMonth() + 1, //月份是从0开始的\r\n          day = date.getDate()\r\n        var newTime = year + '-' +\r\n          month + '-' +\r\n          day + ' '\r\n        return newTime\r\n      },\r\n      //修改生日\r\n      changeBir(value) {\r\n        this.user.birthday = this.formatDate(value)\r\n        this.changeUserAPI({\r\n          birthday: this.user.birthday\r\n        })\r\n        this.birShow = false\r\n      },\r\n\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n  .van-nav-bar {\r\n    background-color: #007bff;\r\n\r\n    /deep/ .van-icon {\r\n      color: #ffffff;\r\n    }\r\n\r\n    /deep/.van-nav-bar__title {\r\n      color: white;\r\n    }\r\n\r\n    /deep/.van-cell {\r\n      font-size: 16Px;\r\n    }\r\n  }\r\n\r\n  .avatar {\r\n    width: 50Px;\r\n    height: 50Px;\r\n  }\r\n</style>"]},"metadata":{},"sourceType":"module"}