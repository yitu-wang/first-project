{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/\\u5C0F\\u738B/Desktop/heimamm/hmtt/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/Users/\\u5C0F\\u738B/Desktop/heimamm/hmtt/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { io } from \"socket.io-client\";\nimport { getToken } from \"@/utils/token.js\";\nexport default {\n  data: function data() {\n    return {\n      value: '',\n      list: [{\n        name: \"xs\",\n        msg: 'hi,你好我是小四'\n      }, {\n        name: \"me\",\n        msg: 'hi,你好我是我'\n      }],\n      socker: null,\n      //客户端和服务区建立的socker对象\n      user: {} //用户资料\n\n    };\n  },\n  created: function created() {\n    var _this = this;\n\n    return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      var res;\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return getUsertotalAPI();\n\n            case 2:\n              res = _context.sent;\n              _this.user = res.data.data;\n              _this.socker = io('http://toutiao.itheima.net', {\n                query: {\n                  token: getToken\n                },\n                transports: ['websocket']\n              }); //判断链接成功没\n\n              _this.socker.on('connect', function () {\n                console.log('连接成功');\n              }); //接收后端传来的消息\n\n\n              _this.socker.on('message', function (data) {\n                _this.list.push({\n                  name: \"xs\",\n                  mag: data.msg\n                });\n              });\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  },\n  methods: {\n    //发送消息\n    sendFn: function sendFn() {\n      //发送到后端的对象\n      if (this.value != '') {\n        this.socker.emit('message', {\n          msg: this.value,\n          timestamp: new Date().getTime()\n        });\n      } //把消息显示到页面内\n\n\n      this.list.push({\n        msg: this.value,\n        name: 'me'\n      });\n      this.value = '';\n    }\n  },\n  destroyed: function destroyed() {\n    this.socker.close();\n    this.socker = null;\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2BA,SACAA,EADA,QAEA,kBAFA;AAGA,SACAC,QADA,QAEA,kBAFA;AAGA;EACAC,IADA,kBACA;IACA;MACAC,SADA;MAEAC;QACAC,UADA;QAEAC;MAFA,GAIA;QACAD,UADA;QAEAC;MAFA,CAJA,CAFA;MAWAC,YAXA;MAWA;MACAC,QAZA,CAYA;;IAZA;EAcA,CAhBA;EAiBAC,OAjBA,qBAiBA;IAAA;;IAAA;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA;cAAA,OACAC,iBADA;;YAAA;cACAC,GADA;cAEA;cACA;gBACAC;kBACAC;gBADA,CADA;gBAIAC;cAJA,GAHA,CASA;;cACA;gBACAC;cACA,CAFA,EAVA,CAaA;;;cACA;gBACA;kBACAV,UADA;kBAEAW;gBAFA;cAIA,CALA;;YAdA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA;EAoBA,CArCA;EAsCAC;IACA;IACAC,MAFA,oBAEA;MACA;MACA;QACA;UACAZ,eADA;UAEAa;QAFA;MAIA,CAPA,CAQA;;;MACA;QACAb,eADA;QAEAD;MAFA;MAIA;IACA;EAhBA,CAtCA;EAwDAe,SAxDA,uBAwDA;IACA;IACA;EACA;AA3DA","names":["io","getToken","data","value","list","name","msg","socker","user","created","getUsertotalAPI","res","query","token","transports","console","mag","methods","sendFn","timestamp","destroyed"],"sourceRoot":"src/views/chat","sources":["index.vue"],"sourcesContent":["//小思同学页面\r\n<template>\r\n  <div class=\"box\">\r\n    <!-- 头部导航 -->\r\n    <van-nav-bar title=\"小思同学\" left-arrow @click-left=\"$router.push('/layout/user')\" />\r\n    <!-- 左边聊天 -->\r\n    <div v-for=\"(item,index) in list\" :key=\"index\">\r\n      <div class=\"left\" v-if=\"item.name==='xs'\">\r\n        <img src=\"@/assets/logo.png\" alt=\"\">\r\n        <div class=\"text\">{{item.msg}}</div>\r\n      </div>\r\n      <!-- 右边聊天 -->\r\n      <div class=\"right\" v-else>\r\n        <div class=\"text\">{{item.msg}}</div>\r\n        <img src=\"user.photo\" alt=\"\">\r\n      </div>\r\n    </div>\r\n    <!-- 底部输入框 -->\r\n    <van-cell-group>\r\n      <van-field v-model=\"value\" placeholder=\"说点什么...\">\r\n        <van-button slot=\"button\" size=\"small\" @click=\"sendFn\">提交</van-button>\r\n      </van-field>\r\n    </van-cell-group>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import {\r\n    io\r\n  } from \"socket.io-client\"\r\n  import {\r\n    getToken\r\n  } from \"@/utils/token.js\"\r\n  export default {\r\n    data() {\r\n      return {\r\n        value: '',\r\n        list: [{\r\n            name: \"xs\",\r\n            msg: 'hi,你好我是小四'\r\n          },\r\n          {\r\n            name: \"me\",\r\n            msg: 'hi,你好我是我'\r\n          },\r\n        ],\r\n        socker: null, //客户端和服务区建立的socker对象\r\n        user: {}, //用户资料\r\n      }\r\n    },\r\n    async created() {\r\n      const res = await getUsertotalAPI()\r\n      this.user = res.data.data\r\n      this.socker = io('http://toutiao.itheima.net', {\r\n        query: {\r\n          token: getToken\r\n        },\r\n        transports: ['websocket']\r\n      })\r\n      //判断链接成功没\r\n      this.socker.on('connect', () => {\r\n        console.log('连接成功');\r\n      })\r\n      //接收后端传来的消息\r\n      this.socker.on('message', data => {\r\n        this.list.push({\r\n          name: \"xs\",\r\n          mag: data.msg\r\n        })\r\n      })\r\n    },\r\n    methods: {\r\n      //发送消息\r\n      sendFn() {\r\n        //发送到后端的对象\r\n        if (this.value != '') {\r\n          this.socker.emit('message', {\r\n            msg: this.value,\r\n            timestamp: new Date().getTime()\r\n          })\r\n        }\r\n        //把消息显示到页面内\r\n        this.list.push({\r\n          msg: this.value,\r\n          name: 'me'\r\n        })\r\n        this.value = ''\r\n      }\r\n    },\r\n    destroyed() {\r\n      this.socker.close()\r\n      this.socker = null\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n  body,\r\n  html {\r\n    max-width: 100%;\r\n    max-height: 100%;\r\n  }\r\n\r\n  .van-nav-bar {\r\n    background-color: #007bff;\r\n\r\n    /deep/ .van-icon {\r\n      color: #ffffff;\r\n    }\r\n\r\n    /deep/.van-nav-bar__title {\r\n      color: white;\r\n    }\r\n\r\n    /deep/.van-cell {\r\n      font-size: 16Px;\r\n    }\r\n  }\r\n\r\n  /deep/.van-button--default {\r\n    font-size: 15Px;\r\n    border: none;\r\n  }\r\n\r\n  .van-cell-group {\r\n    position: fixed;\r\n    bottom: 0;\r\n    width: 100%;\r\n  }\r\n\r\n  .left {\r\n    float: left;\r\n    width: 90%;\r\n    margin-left: 5Px;\r\n    margin-top: 20Px;\r\n\r\n    img {\r\n      width: 50Px;\r\n      height: 50Px;\r\n      border-radius: 100%;\r\n      vertical-align: top;\r\n\r\n    }\r\n\r\n    .text {\r\n      position: relative;\r\n      display: inline-block;\r\n      max-width: 65%;\r\n      font-size: 14Px;\r\n      margin-left: 15Px;\r\n      background-color: #d7e5f5;\r\n      word-break: break-all;\r\n      padding: 8Px;\r\n      border-radius: 8Px;\r\n    }\r\n\r\n    .text::before {\r\n      content: '';\r\n      width: 10Px;\r\n      height: 10Px;\r\n      background-color: #d7e5f5;\r\n      position: absolute;\r\n      left: -4Px;\r\n      top: 10Px;\r\n      transform: rotate(45deg);\r\n    }\r\n  }\r\n\r\n  .right {\r\n    float: right;\r\n    width: 90%;\r\n    margin-right: 5Px;\r\n    margin-top: 20Px;\r\n    text-align: right;\r\n\r\n    .text {\r\n      position: relative;\r\n      display: inline-block;\r\n      max-width: 65%;\r\n      font-size: 14Px;\r\n      background-color: #d7e5f5;\r\n      word-break: break-all;\r\n      padding: 8Px;\r\n      border-radius: 8Px;\r\n      vertical-align: middle;\r\n      margin-right: 15Px;\r\n    }\r\n\r\n    .text::before {\r\n      content: '';\r\n      width: 10Px;\r\n      height: 10Px;\r\n      background-color: #d7e5f5;\r\n      position: absolute;\r\n      right: -4Px;\r\n      top: 10Px;\r\n      transform: rotate(45deg);\r\n    }\r\n\r\n    img {\r\n      float: right;\r\n      width: 50Px;\r\n      height: 50Px;\r\n      border-radius: 100%;\r\n      vertical-align: top;\r\n    }\r\n  }\r\n</style>"]},"metadata":{},"sourceType":"module"}