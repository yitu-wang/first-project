{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport { UNSELECTED_SKU_VALUE_ID } from '../constants';\n/*\n  normalize sku tree\n\n  [\n    {\n      count: 2,\n      k: \"品种\", // 规格名称 skuKeyName\n      k_id: \"1200\", // skuKeyId\n      k_s: \"s1\" // skuKeyStr\n      v: [ // skuValues\n        { // skuValue\n          id: \"1201\", // skuValueId\n          name: \"萌\" // 具体的规格值 skuValueName\n        }, {\n          id: \"973\",\n          name: \"帅\"\n        }\n      ]\n    },\n    ...\n  ]\n                |\n                v\n  {\n    s1: [{\n      id: \"1201\",\n      name: \"萌\"\n    }, {\n      id: \"973\",\n      name: \"帅\"\n    }],\n    ...\n  }\n */\n\nexport var normalizeSkuTree = function normalizeSkuTree(skuTree) {\n  var normalizedTree = {};\n  skuTree.forEach(function (treeItem) {\n    normalizedTree[treeItem.k_s] = treeItem.v;\n  });\n  return normalizedTree;\n};\nexport var normalizePropList = function normalizePropList(propList) {\n  var normalizedProp = {};\n  propList.forEach(function (item) {\n    var itemObj = {};\n    item.v.forEach(function (it) {\n      itemObj[it.id] = it;\n    });\n    normalizedProp[item.k_id] = itemObj;\n  });\n  return normalizedProp;\n}; // 判断是否所有的sku都已经选中\n\nexport var isAllSelected = function isAllSelected(skuTree, selectedSku) {\n  // 筛选selectedSku对象中key值不为空的值\n  var selected = Object.keys(selectedSku).filter(function (skuKeyStr) {\n    return selectedSku[skuKeyStr] !== UNSELECTED_SKU_VALUE_ID;\n  });\n  return skuTree.length === selected.length;\n}; // 根据已选择的 sku 获取 skuComb\n\nexport var getSkuComb = function getSkuComb(skuList, selectedSku) {\n  var skuComb = skuList.filter(function (item) {\n    return Object.keys(selectedSku).every(function (skuKeyStr) {\n      return String(item[skuKeyStr]) === String(selectedSku[skuKeyStr]);\n    });\n  });\n  return skuComb[0];\n}; // 获取已选择的sku名称\n\nexport var getSelectedSkuValues = function getSelectedSkuValues(skuTree, selectedSku) {\n  var normalizedTree = normalizeSkuTree(skuTree);\n  return Object.keys(selectedSku).reduce(function (selectedValues, skuKeyStr) {\n    var skuValues = normalizedTree[skuKeyStr] || [];\n    var skuValueId = selectedSku[skuKeyStr];\n\n    if (skuValueId !== UNSELECTED_SKU_VALUE_ID && skuValues.length > 0) {\n      var skuValue = skuValues.filter(function (value) {\n        return value.id === skuValueId;\n      })[0];\n      skuValue && selectedValues.push(skuValue);\n    }\n\n    return selectedValues;\n  }, []);\n}; // 判断sku是否可选\n\nexport var isSkuChoosable = function isSkuChoosable(skuList, selectedSku, skuToChoose) {\n  var _extends2;\n\n  var key = skuToChoose.key,\n      valueId = skuToChoose.valueId; // 先假设sku已选中，拼入已选中sku对象中\n\n  var matchedSku = _extends({}, selectedSku, (_extends2 = {}, _extends2[key] = valueId, _extends2)); // 再判断剩余sku是否全部不可选，若不可选则当前sku不可选中\n\n\n  var skusToCheck = Object.keys(matchedSku).filter(function (skuKey) {\n    return matchedSku[skuKey] !== UNSELECTED_SKU_VALUE_ID;\n  });\n  var filteredSku = skuList.filter(function (sku) {\n    return skusToCheck.every(function (skuKey) {\n      return String(matchedSku[skuKey]) === String(sku[skuKey]);\n    });\n  });\n  var stock = filteredSku.reduce(function (total, sku) {\n    total += sku.stock_num;\n    return total;\n  }, 0);\n  return stock > 0;\n};\nexport var getSelectedPropValues = function getSelectedPropValues(propList, selectedProp) {\n  var normalizeProp = normalizePropList(propList);\n  return Object.keys(selectedProp).reduce(function (acc, cur) {\n    selectedProp[cur].forEach(function (it) {\n      acc.push(_extends({}, normalizeProp[cur][it]));\n    });\n    return acc;\n  }, []);\n};\nexport var getSelectedProperties = function getSelectedProperties(propList, selectedProp) {\n  var list = [];\n  (propList || []).forEach(function (prop) {\n    if (selectedProp[prop.k_id] && selectedProp[prop.k_id].length > 0) {\n      var v = [];\n      prop.v.forEach(function (it) {\n        if (selectedProp[prop.k_id].indexOf(it.id) > -1) {\n          v.push(_extends({}, it));\n        }\n      });\n      list.push(_extends({}, prop, {\n        v: v\n      }));\n    }\n  });\n  return list;\n};\nexport default {\n  normalizeSkuTree: normalizeSkuTree,\n  getSkuComb: getSkuComb,\n  getSelectedSkuValues: getSelectedSkuValues,\n  isAllSelected: isAllSelected,\n  isSkuChoosable: isSkuChoosable,\n  getSelectedPropValues: getSelectedPropValues,\n  getSelectedProperties: getSelectedProperties\n};","map":{"version":3,"names":["_extends","UNSELECTED_SKU_VALUE_ID","normalizeSkuTree","skuTree","normalizedTree","forEach","treeItem","k_s","v","normalizePropList","propList","normalizedProp","item","itemObj","it","id","k_id","isAllSelected","selectedSku","selected","Object","keys","filter","skuKeyStr","length","getSkuComb","skuList","skuComb","every","String","getSelectedSkuValues","reduce","selectedValues","skuValues","skuValueId","skuValue","value","push","isSkuChoosable","skuToChoose","_extends2","key","valueId","matchedSku","skusToCheck","skuKey","filteredSku","sku","stock","total","stock_num","getSelectedPropValues","selectedProp","normalizeProp","acc","cur","getSelectedProperties","list","prop","indexOf"],"sources":["C:/Users/小王/node_modules/vant/es/sku/utils/sku-helper.js"],"sourcesContent":["import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport { UNSELECTED_SKU_VALUE_ID } from '../constants';\n/*\n  normalize sku tree\n\n  [\n    {\n      count: 2,\n      k: \"品种\", // 规格名称 skuKeyName\n      k_id: \"1200\", // skuKeyId\n      k_s: \"s1\" // skuKeyStr\n      v: [ // skuValues\n        { // skuValue\n          id: \"1201\", // skuValueId\n          name: \"萌\" // 具体的规格值 skuValueName\n        }, {\n          id: \"973\",\n          name: \"帅\"\n        }\n      ]\n    },\n    ...\n  ]\n                |\n                v\n  {\n    s1: [{\n      id: \"1201\",\n      name: \"萌\"\n    }, {\n      id: \"973\",\n      name: \"帅\"\n    }],\n    ...\n  }\n */\n\nexport var normalizeSkuTree = function normalizeSkuTree(skuTree) {\n  var normalizedTree = {};\n  skuTree.forEach(function (treeItem) {\n    normalizedTree[treeItem.k_s] = treeItem.v;\n  });\n  return normalizedTree;\n};\nexport var normalizePropList = function normalizePropList(propList) {\n  var normalizedProp = {};\n  propList.forEach(function (item) {\n    var itemObj = {};\n    item.v.forEach(function (it) {\n      itemObj[it.id] = it;\n    });\n    normalizedProp[item.k_id] = itemObj;\n  });\n  return normalizedProp;\n}; // 判断是否所有的sku都已经选中\n\nexport var isAllSelected = function isAllSelected(skuTree, selectedSku) {\n  // 筛选selectedSku对象中key值不为空的值\n  var selected = Object.keys(selectedSku).filter(function (skuKeyStr) {\n    return selectedSku[skuKeyStr] !== UNSELECTED_SKU_VALUE_ID;\n  });\n  return skuTree.length === selected.length;\n}; // 根据已选择的 sku 获取 skuComb\n\nexport var getSkuComb = function getSkuComb(skuList, selectedSku) {\n  var skuComb = skuList.filter(function (item) {\n    return Object.keys(selectedSku).every(function (skuKeyStr) {\n      return String(item[skuKeyStr]) === String(selectedSku[skuKeyStr]);\n    });\n  });\n  return skuComb[0];\n}; // 获取已选择的sku名称\n\nexport var getSelectedSkuValues = function getSelectedSkuValues(skuTree, selectedSku) {\n  var normalizedTree = normalizeSkuTree(skuTree);\n  return Object.keys(selectedSku).reduce(function (selectedValues, skuKeyStr) {\n    var skuValues = normalizedTree[skuKeyStr] || [];\n    var skuValueId = selectedSku[skuKeyStr];\n\n    if (skuValueId !== UNSELECTED_SKU_VALUE_ID && skuValues.length > 0) {\n      var skuValue = skuValues.filter(function (value) {\n        return value.id === skuValueId;\n      })[0];\n      skuValue && selectedValues.push(skuValue);\n    }\n\n    return selectedValues;\n  }, []);\n}; // 判断sku是否可选\n\nexport var isSkuChoosable = function isSkuChoosable(skuList, selectedSku, skuToChoose) {\n  var _extends2;\n\n  var key = skuToChoose.key,\n      valueId = skuToChoose.valueId; // 先假设sku已选中，拼入已选中sku对象中\n\n  var matchedSku = _extends({}, selectedSku, (_extends2 = {}, _extends2[key] = valueId, _extends2)); // 再判断剩余sku是否全部不可选，若不可选则当前sku不可选中\n\n\n  var skusToCheck = Object.keys(matchedSku).filter(function (skuKey) {\n    return matchedSku[skuKey] !== UNSELECTED_SKU_VALUE_ID;\n  });\n  var filteredSku = skuList.filter(function (sku) {\n    return skusToCheck.every(function (skuKey) {\n      return String(matchedSku[skuKey]) === String(sku[skuKey]);\n    });\n  });\n  var stock = filteredSku.reduce(function (total, sku) {\n    total += sku.stock_num;\n    return total;\n  }, 0);\n  return stock > 0;\n};\nexport var getSelectedPropValues = function getSelectedPropValues(propList, selectedProp) {\n  var normalizeProp = normalizePropList(propList);\n  return Object.keys(selectedProp).reduce(function (acc, cur) {\n    selectedProp[cur].forEach(function (it) {\n      acc.push(_extends({}, normalizeProp[cur][it]));\n    });\n    return acc;\n  }, []);\n};\nexport var getSelectedProperties = function getSelectedProperties(propList, selectedProp) {\n  var list = [];\n  (propList || []).forEach(function (prop) {\n    if (selectedProp[prop.k_id] && selectedProp[prop.k_id].length > 0) {\n      var v = [];\n      prop.v.forEach(function (it) {\n        if (selectedProp[prop.k_id].indexOf(it.id) > -1) {\n          v.push(_extends({}, it));\n        }\n      });\n      list.push(_extends({}, prop, {\n        v: v\n      }));\n    }\n  });\n  return list;\n};\nexport default {\n  normalizeSkuTree: normalizeSkuTree,\n  getSkuComb: getSkuComb,\n  getSelectedSkuValues: getSelectedSkuValues,\n  isAllSelected: isAllSelected,\n  isSkuChoosable: isSkuChoosable,\n  getSelectedPropValues: getSelectedPropValues,\n  getSelectedProperties: getSelectedProperties\n};"],"mappings":"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"},"metadata":{},"sourceType":"module"}