{"ast":null,"code":"import \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/es.array.join.js\";\nimport { createNamespace } from '../../utils';\nimport { LIMIT_TYPE } from '../constants';\nimport Stepper from '../../stepper';\nvar namespace = createNamespace('sku-stepper');\nvar createComponent = namespace[0];\nvar t = namespace[2];\nvar QUOTA_LIMIT = LIMIT_TYPE.QUOTA_LIMIT,\n    STOCK_LIMIT = LIMIT_TYPE.STOCK_LIMIT;\nexport default createComponent({\n  props: {\n    stock: Number,\n    skuEventBus: Object,\n    skuStockNum: Number,\n    selectedNum: Number,\n    stepperTitle: String,\n    disableStepperInput: Boolean,\n    customStepperConfig: Object,\n    hideQuotaText: Boolean,\n    quota: {\n      type: Number,\n      default: 0\n    },\n    quotaUsed: {\n      type: Number,\n      default: 0\n    },\n    startSaleNum: {\n      type: Number,\n      default: 1\n    }\n  },\n  data: function data() {\n    return {\n      currentNum: this.selectedNum,\n      // 购买限制类型: 限购/库存\n      limitType: STOCK_LIMIT\n    };\n  },\n  watch: {\n    currentNum: function currentNum(num) {\n      var intValue = parseInt(num, 10);\n\n      if (intValue >= this.stepperMinLimit && intValue <= this.stepperLimit) {\n        this.skuEventBus.$emit('sku:numChange', intValue);\n      }\n    },\n    stepperLimit: function stepperLimit(limit) {\n      if (limit < this.currentNum && this.stepperMinLimit <= limit) {\n        this.currentNum = limit;\n      }\n\n      this.checkState(this.stepperMinLimit, limit);\n    },\n    stepperMinLimit: function stepperMinLimit(start) {\n      if (start > this.currentNum || start > this.stepperLimit) {\n        this.currentNum = start;\n      }\n\n      this.checkState(start, this.stepperLimit);\n    }\n  },\n  computed: {\n    stepperLimit: function stepperLimit() {\n      var quotaLimit = this.quota - this.quotaUsed;\n      var limit; // 无限购时直接取库存，有限购时取限购数和库存数中小的那个\n\n      if (this.quota > 0 && quotaLimit <= this.stock) {\n        // 修正负的limit\n        limit = quotaLimit < 0 ? 0 : quotaLimit;\n        this.limitType = QUOTA_LIMIT;\n      } else {\n        limit = this.stock;\n        this.limitType = STOCK_LIMIT;\n      }\n\n      return limit;\n    },\n    stepperMinLimit: function stepperMinLimit() {\n      return this.startSaleNum < 1 ? 1 : this.startSaleNum;\n    },\n    quotaText: function quotaText() {\n      var _this$customStepperCo = this.customStepperConfig,\n          quotaText = _this$customStepperCo.quotaText,\n          hideQuotaText = _this$customStepperCo.hideQuotaText;\n      if (hideQuotaText) return '';\n      var text = '';\n\n      if (quotaText) {\n        text = quotaText;\n      } else {\n        var textArr = [];\n\n        if (this.startSaleNum > 1) {\n          textArr.push(t('quotaStart', this.startSaleNum));\n        }\n\n        if (this.quota > 0) {\n          textArr.push(t('quotaLimit', this.quota));\n        }\n\n        text = textArr.join(t('comma'));\n      }\n\n      return text;\n    }\n  },\n  created: function created() {\n    this.checkState(this.stepperMinLimit, this.stepperLimit);\n  },\n  methods: {\n    setCurrentNum: function setCurrentNum(num) {\n      this.currentNum = num;\n      this.checkState(this.stepperMinLimit, this.stepperLimit);\n    },\n    onOverLimit: function onOverLimit(action) {\n      this.skuEventBus.$emit('sku:overLimit', {\n        action: action,\n        limitType: this.limitType,\n        quota: this.quota,\n        quotaUsed: this.quotaUsed,\n        startSaleNum: this.startSaleNum\n      });\n    },\n    onChange: function onChange(currentValue) {\n      var intValue = parseInt(currentValue, 10);\n      var handleStepperChange = this.customStepperConfig.handleStepperChange;\n      handleStepperChange && handleStepperChange(intValue);\n      this.$emit('change', intValue);\n    },\n    checkState: function checkState(min, max) {\n      // 如果选择小于起售，则强制变为起售\n      if (this.currentNum < min || min > max) {\n        this.currentNum = min;\n      } else if (this.currentNum > max) {\n        // 当前选择数量大于最大可选时，需要重置已选数量\n        this.currentNum = max;\n      }\n\n      this.skuEventBus.$emit('sku:stepperState', {\n        valid: min <= max,\n        min: min,\n        max: max,\n        limitType: this.limitType,\n        quota: this.quota,\n        quotaUsed: this.quotaUsed,\n        startSaleNum: this.startSaleNum\n      });\n    }\n  },\n  render: function render() {\n    var _this = this;\n\n    var h = arguments[0];\n    return h(\"div\", {\n      \"class\": \"van-sku-stepper-stock\"\n    }, [h(\"div\", {\n      \"class\": \"van-sku__stepper-title\"\n    }, [this.stepperTitle || t('num')]), h(Stepper, {\n      \"attrs\": {\n        \"integer\": true,\n        \"min\": this.stepperMinLimit,\n        \"max\": this.stepperLimit,\n        \"disableInput\": this.disableStepperInput\n      },\n      \"class\": \"van-sku__stepper\",\n      \"on\": {\n        \"overlimit\": this.onOverLimit,\n        \"change\": this.onChange\n      },\n      \"model\": {\n        value: _this.currentNum,\n        callback: function callback($$v) {\n          _this.currentNum = $$v;\n        }\n      }\n    }), !this.hideQuotaText && this.quotaText && h(\"span\", {\n      \"class\": \"van-sku__stepper-quota\"\n    }, [\"(\", this.quotaText, \")\"])]);\n  }\n});","map":{"version":3,"names":["createNamespace","LIMIT_TYPE","Stepper","namespace","createComponent","t","QUOTA_LIMIT","STOCK_LIMIT","props","stock","Number","skuEventBus","Object","skuStockNum","selectedNum","stepperTitle","String","disableStepperInput","Boolean","customStepperConfig","hideQuotaText","quota","type","default","quotaUsed","startSaleNum","data","currentNum","limitType","watch","num","intValue","parseInt","stepperMinLimit","stepperLimit","$emit","limit","checkState","start","computed","quotaLimit","quotaText","_this$customStepperCo","text","textArr","push","join","created","methods","setCurrentNum","onOverLimit","action","onChange","currentValue","handleStepperChange","min","max","valid","render","_this","h","arguments","value","callback","$$v"],"sources":["C:/Users/小王/node_modules/vant/es/sku/components/SkuStepper.js"],"sourcesContent":["import { createNamespace } from '../../utils';\nimport { LIMIT_TYPE } from '../constants';\nimport Stepper from '../../stepper';\nvar namespace = createNamespace('sku-stepper');\nvar createComponent = namespace[0];\nvar t = namespace[2];\nvar QUOTA_LIMIT = LIMIT_TYPE.QUOTA_LIMIT,\n    STOCK_LIMIT = LIMIT_TYPE.STOCK_LIMIT;\nexport default createComponent({\n  props: {\n    stock: Number,\n    skuEventBus: Object,\n    skuStockNum: Number,\n    selectedNum: Number,\n    stepperTitle: String,\n    disableStepperInput: Boolean,\n    customStepperConfig: Object,\n    hideQuotaText: Boolean,\n    quota: {\n      type: Number,\n      default: 0\n    },\n    quotaUsed: {\n      type: Number,\n      default: 0\n    },\n    startSaleNum: {\n      type: Number,\n      default: 1\n    }\n  },\n  data: function data() {\n    return {\n      currentNum: this.selectedNum,\n      // 购买限制类型: 限购/库存\n      limitType: STOCK_LIMIT\n    };\n  },\n  watch: {\n    currentNum: function currentNum(num) {\n      var intValue = parseInt(num, 10);\n\n      if (intValue >= this.stepperMinLimit && intValue <= this.stepperLimit) {\n        this.skuEventBus.$emit('sku:numChange', intValue);\n      }\n    },\n    stepperLimit: function stepperLimit(limit) {\n      if (limit < this.currentNum && this.stepperMinLimit <= limit) {\n        this.currentNum = limit;\n      }\n\n      this.checkState(this.stepperMinLimit, limit);\n    },\n    stepperMinLimit: function stepperMinLimit(start) {\n      if (start > this.currentNum || start > this.stepperLimit) {\n        this.currentNum = start;\n      }\n\n      this.checkState(start, this.stepperLimit);\n    }\n  },\n  computed: {\n    stepperLimit: function stepperLimit() {\n      var quotaLimit = this.quota - this.quotaUsed;\n      var limit; // 无限购时直接取库存，有限购时取限购数和库存数中小的那个\n\n      if (this.quota > 0 && quotaLimit <= this.stock) {\n        // 修正负的limit\n        limit = quotaLimit < 0 ? 0 : quotaLimit;\n        this.limitType = QUOTA_LIMIT;\n      } else {\n        limit = this.stock;\n        this.limitType = STOCK_LIMIT;\n      }\n\n      return limit;\n    },\n    stepperMinLimit: function stepperMinLimit() {\n      return this.startSaleNum < 1 ? 1 : this.startSaleNum;\n    },\n    quotaText: function quotaText() {\n      var _this$customStepperCo = this.customStepperConfig,\n          quotaText = _this$customStepperCo.quotaText,\n          hideQuotaText = _this$customStepperCo.hideQuotaText;\n      if (hideQuotaText) return '';\n      var text = '';\n\n      if (quotaText) {\n        text = quotaText;\n      } else {\n        var textArr = [];\n\n        if (this.startSaleNum > 1) {\n          textArr.push(t('quotaStart', this.startSaleNum));\n        }\n\n        if (this.quota > 0) {\n          textArr.push(t('quotaLimit', this.quota));\n        }\n\n        text = textArr.join(t('comma'));\n      }\n\n      return text;\n    }\n  },\n  created: function created() {\n    this.checkState(this.stepperMinLimit, this.stepperLimit);\n  },\n  methods: {\n    setCurrentNum: function setCurrentNum(num) {\n      this.currentNum = num;\n      this.checkState(this.stepperMinLimit, this.stepperLimit);\n    },\n    onOverLimit: function onOverLimit(action) {\n      this.skuEventBus.$emit('sku:overLimit', {\n        action: action,\n        limitType: this.limitType,\n        quota: this.quota,\n        quotaUsed: this.quotaUsed,\n        startSaleNum: this.startSaleNum\n      });\n    },\n    onChange: function onChange(currentValue) {\n      var intValue = parseInt(currentValue, 10);\n      var handleStepperChange = this.customStepperConfig.handleStepperChange;\n      handleStepperChange && handleStepperChange(intValue);\n      this.$emit('change', intValue);\n    },\n    checkState: function checkState(min, max) {\n      // 如果选择小于起售，则强制变为起售\n      if (this.currentNum < min || min > max) {\n        this.currentNum = min;\n      } else if (this.currentNum > max) {\n        // 当前选择数量大于最大可选时，需要重置已选数量\n        this.currentNum = max;\n      }\n\n      this.skuEventBus.$emit('sku:stepperState', {\n        valid: min <= max,\n        min: min,\n        max: max,\n        limitType: this.limitType,\n        quota: this.quota,\n        quotaUsed: this.quotaUsed,\n        startSaleNum: this.startSaleNum\n      });\n    }\n  },\n  render: function render() {\n    var _this = this;\n\n    var h = arguments[0];\n    return h(\"div\", {\n      \"class\": \"van-sku-stepper-stock\"\n    }, [h(\"div\", {\n      \"class\": \"van-sku__stepper-title\"\n    }, [this.stepperTitle || t('num')]), h(Stepper, {\n      \"attrs\": {\n        \"integer\": true,\n        \"min\": this.stepperMinLimit,\n        \"max\": this.stepperLimit,\n        \"disableInput\": this.disableStepperInput\n      },\n      \"class\": \"van-sku__stepper\",\n      \"on\": {\n        \"overlimit\": this.onOverLimit,\n        \"change\": this.onChange\n      },\n      \"model\": {\n        value: _this.currentNum,\n        callback: function callback($$v) {\n          _this.currentNum = $$v;\n        }\n      }\n    }), !this.hideQuotaText && this.quotaText && h(\"span\", {\n      \"class\": \"van-sku__stepper-quota\"\n    }, [\"(\", this.quotaText, \")\"])]);\n  }\n});"],"mappings":"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"},"metadata":{},"sourceType":"module"}