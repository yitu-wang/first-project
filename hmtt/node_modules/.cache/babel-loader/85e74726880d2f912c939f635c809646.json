{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { suggestListAPI } from \"@/api/index.js\";\nimport router from '@/router';\nexport default {\n  data() {\n    return {\n      kw: '',\n      //搜索关键词\n      timer: null,\n      //定时器\n      keywordList: [],\n      //关键词联想数组\n      history: JSON.parse(localStorage.getItem('his')) || [] //利用json转换为数组对象格式\n\n    };\n  },\n\n  methods: {\n    //搜索框输入方法\n    inputFn() {\n      //防抖(设置定时器，然后每次触发时清除定时器)\n      clearTimeout(this.timer);\n      this.timer = setTimeout(async () => {\n        if (this.kw.length === 0) return;\n        const {\n          data: res\n        } = await suggestListAPI({\n          keyword: this.kw\n        });\n        this.keywordList = res.data.options;\n      }, 300);\n    },\n\n    //处理关键词高亮\n    lightFn(str, target) {\n      //str是原来的字符串\n      //target是关键字\n      //变量不能直接放入正则表达式中，需要新建正则实例\n      let reg = new RegExp(target, 'ig');\n      return str.replaceAll(reg, match => {\n        return `<span style=\"color:red;\">${match}</span>`;\n      });\n    },\n\n    //搜索事件\n    searchFn() {\n      if (this.kw.length === 0) return; //将搜索的关键词保存到历史纪录里\n\n      this.history.push(this.kw);\n      setTimeout(() => {\n        this.$router.push({\n          path: `/search_result/${this.kw}`\n        });\n      }, 0);\n    },\n\n    //点击联想列表跳转\n    suggestClick(item) {\n      this.history.push(item);\n      setTimeout(() => {\n        this.$router.push({\n          path: `/search_result/${item}`\n        });\n      }, 0);\n    },\n\n    //点击历史记录跳转\n    historyClick(item) {\n      this.$router.push({\n        path: `/search_result/${item}`\n      });\n    },\n\n    //点击清空历史列表\n    clearFn() {\n      this.history = [];\n    }\n\n  },\n  //利用监听器将history的变化保存在本地\n  watch: {\n    history: {\n      deep: true,\n\n      handler() {\n        //立即覆盖式的保存在本地\n        //本地存储只能存储字符串类型，所以需要用json来转换\n        //因为多次输入同一个关键词会被重复记录，所以需要去重\n        const theSet = new Set(this.history);\n        const arr = Array.from(theSet);\n        localStorage.setItem('his', JSON.stringify(arr));\n      }\n\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiCA,SACAA,cADA,QAEA,gBAFA;AAGA;AACA;EACAC;IACA;MACAC,MADA;MACA;MACAC,WAFA;MAEA;MACAC,eAHA;MAGA;MACAC,sDAJA,CAIA;;IAJA;EAMA,CARA;;EASAC;IACA;IACAC;MACA;MACAC;MAEA;QACA;QAEA;UACAP;QADA,IAEA;UACAQ;QADA,EAFA;QAKA;MACA,CATA,EASA,GATA;IAUA,CAhBA;;IAiBA;IACAC;MACA;MACA;MACA;MACA;MACA;QACA;MACA,CAFA;IAGA,CA1BA;;IA2BA;IACAC;MACA,iCADA,CAEA;;MACA;MACAC;QACA;UACAC;QADA;MAGA,CAJA,EAIA,CAJA;IAMA,CAtCA;;IAuCA;IACAC;MACA;MACAF;QACA;UACAC;QADA;MAGA,CAJA,EAIA,CAJA;IAMA,CAhDA;;IAiDA;IACAE;MACA;QACAF;MADA;IAGA,CAtDA;;IAuDA;IACAG;MACA;IACA;;EA1DA,CATA;EAqEA;EACAC;IACAZ;MACAa,UADA;;MAEAC;QACA;QACA;QACA;QACA;QACA;QACAC;MACA;;IATA;EADA;AAtEA","names":["suggestListAPI","data","kw","timer","keywordList","history","methods","inputFn","clearTimeout","keyword","lightFn","searchFn","setTimeout","path","suggestClick","historyClick","clearFn","watch","deep","handler","localStorage"],"sourceRoot":"src/views/search","sources":["index.vue"],"sourcesContent":["// 搜索页面\r\n<template>\r\n  <div>\r\n    <!-- 搜索头部 -->\r\n    <div class=\"search-header\" style=\"height: 46px\">\r\n      <van-icon name=\"arrow-left\" color=\"white\" size=\"18px\" class=\"goback\" @click=\"$router.go(-1)\"\r\n        style=\"padding-left: 14px\" />\r\n      <van-search placeholder=\"请输入关键词\" background=\"#007bff\" shape=\"round\" v-fofo @input=\"inputFn\" v-model=\"kw\"\r\n        @search=\"searchFn\" />\r\n    </div>\r\n    <!-- 搜索关键词联想列表 -->\r\n    <div class=\"sugg-list\">\r\n      <div class=\"sugg-item\" v-for=\"(item,index) in keywordList\" :key=\"index\" v-if=\"kw.length!==0\"\r\n        v-html=\"lightFn(item, kw)\" @click=\"suggestClick(item)\">\r\n      </div>\r\n    </div>\r\n    <!-- 搜索历史 -->\r\n    <div class=\"search-history\" v-show=\"kw.length===0\">\r\n      <!-- 标题 -->\r\n      <van-cell title=\"搜索历史\">\r\n        <template #right-icon>\r\n          <van-icon name=\"delete\" class=\"search-icon\" @click=\"clearFn\"></van-icon>\r\n        </template>\r\n      </van-cell>\r\n      <!-- 历史列表 -->\r\n      <div class=\"history-list\">\r\n        <span class=\"history-item\" v-for=\"(item,index) in history\" @click=\"historyClick(item)\">{{item}}</span>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import {\r\n    suggestListAPI\r\n  } from \"@/api/index.js\"\r\n  import router from '@/router'\r\n  export default {\r\n    data() {\r\n      return {\r\n        kw: '', //搜索关键词\r\n        timer: null, //定时器\r\n        keywordList: [], //关键词联想数组\r\n        history: JSON.parse(localStorage.getItem('his')) || [] //利用json转换为数组对象格式\r\n      }\r\n    },\r\n    methods: {\r\n      //搜索框输入方法\r\n      inputFn() {\r\n        //防抖(设置定时器，然后每次触发时清除定时器)\r\n        clearTimeout(this.timer)\r\n\r\n        this.timer = setTimeout(async () => {\r\n          if (this.kw.length === 0) return\r\n\r\n          const {\r\n            data: res\r\n          } = await suggestListAPI({\r\n            keyword: this.kw\r\n          })\r\n          this.keywordList = res.data.options\r\n        }, 300)\r\n      },\r\n      //处理关键词高亮\r\n      lightFn(str, target) {\r\n        //str是原来的字符串\r\n        //target是关键字\r\n        //变量不能直接放入正则表达式中，需要新建正则实例\r\n        let reg = new RegExp(target, 'ig')\r\n        return str.replaceAll(reg, (match) => {\r\n          return `<span style=\"color:red;\">${match}</span>`\r\n        })\r\n      },\r\n      //搜索事件\r\n      searchFn() {\r\n        if (this.kw.length === 0) return\r\n        //将搜索的关键词保存到历史纪录里\r\n        this.history.push(this.kw)\r\n        setTimeout(() => {\r\n          this.$router.push({\r\n            path: `/search_result/${this.kw}`,\r\n          })\r\n        }, 0)\r\n\r\n      },\r\n      //点击联想列表跳转\r\n      suggestClick(item) {\r\n        this.history.push(item)\r\n        setTimeout(() => {\r\n          this.$router.push({\r\n            path: `/search_result/${item}`,\r\n          })\r\n        }, 0)\r\n\r\n      },\r\n      //点击历史记录跳转\r\n      historyClick(item) {\r\n        this.$router.push({\r\n          path: `/search_result/${item}`,\r\n        })\r\n      },\r\n      //点击清空历史列表\r\n      clearFn() {\r\n        this.history = []\r\n      }\r\n    },\r\n    //利用监听器将history的变化保存在本地\r\n    watch: {\r\n      history: {\r\n        deep: true,\r\n        handler() {\r\n          //立即覆盖式的保存在本地\r\n          //本地存储只能存储字符串类型，所以需要用json来转换\r\n          //因为多次输入同一个关键词会被重复记录，所以需要去重\r\n          const theSet = new Set(this.history)\r\n          const arr = Array.from(theSet)\r\n          localStorage.setItem('his', JSON.stringify(arr))\r\n        }\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n  .search-header {\r\n    display: flex;\r\n    align-items: center;\r\n    background-color: #007bff;\r\n    overflow: hidden;\r\n\r\n    .van-search {\r\n      flex: 1;\r\n    }\r\n  }\r\n\r\n  .sugg-list {\r\n    .sugg-item {\r\n      padding: 0 15Px;\r\n      border-bottom: 1Px solid #f8f8f8;\r\n      font-size: 14Px;\r\n      line-height: 50Px;\r\n      white-space: nowrap;\r\n      overflow: hidden;\r\n      text-overflow: ellipsis;\r\n    }\r\n  }\r\n\r\n  .search-icon {\r\n    font-size: 16Px;\r\n    line-height: inherit;\r\n  }\r\n\r\n  .history-list {\r\n    padding: 0 10Px;\r\n\r\n    .history-item {\r\n      display: inline-block;\r\n      font-size: 12Px;\r\n      padding: 8Px 14Px;\r\n      background-color: #efefef;\r\n      margin: 10Px 8Px 0Px 8Px;\r\n      border-radius: 10Px;\r\n    }\r\n  }\r\n</style>"]},"metadata":{},"sourceType":"module"}